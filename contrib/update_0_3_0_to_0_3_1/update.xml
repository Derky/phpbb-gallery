<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.1.xsd">
  <header>
    <license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
    <title lang="en-gb">phpBB Gallery</title>
    <description lang="en-gb">see normal install-file</description>
    <author-notes lang="en-gb">i hope you get it installed, otherwise you can ask for help on phpbb.de and phpbb.com



	NOTE: If you want to be informed, when there should be a new version of this MOD available,
	Please register on my Site and join the Group "MODs - phpBB Gallery - Newsletter".

	I you want to be informed when i release any new version for one of my MODs join the Group "MODs - Newsletter"</author-notes>
    <author-group>
      <author>
        <realname>nickvergessen</realname>
        <email>nickvergessen@gmx.de</email>
        <username>nickvergessen</username>
        <homepage>http://www.flying-bits.org</homepage>
        <contributions />
      </author>
    </author-group>
    <mod-version>0.3.1</mod-version>
    <installation>
      <level>easy</level>
      <time>240</time>
      <target-version>3.0.1</target-version>
    </installation>
    <link-group>
      <link type="parent" lang="en-gb" href="../history.xml">History</link>
      <link type="parent" lang="de" href="../history.xml">Entwicklung</link>
      <link type="parent" lang="en-gb" href="../../install.xml">Install</link>
      <link type="parent" lang="de" href="../../install.xml">Installations-Anleitung</link>
      <link type="parent" lang="en-gb" href="../update_0_3_1_to_0_4_0-RC1/update.xml">Update from 0.3.1 to 0.4.0-RC1</link>
      <link type="parent" lang="de" href="../update_0_3_1_to_0_4_0-RC1/update.xml">Update von 0.3.1 auf 0.4.0-RC1</link>
    </link-group>
    <history>
      <entry>
        <date>2008-04-14</date>
        <rev-version>0.3.1</rev-version>
        <changelog lang="en-GB">
          <change><![CDATA[[Add] Report #150: mcp "select all"]]></change>
          <change><![CDATA[[Add] Report #166: select multiple images for delete]]></change>

          <change><![CDATA[[Change] Report #257: wrong prev and next images]]></change>
          <change><![CDATA[[Change] Report #247: KiB not KB]]></change>

          <change><![CDATA[[Fix] Report #235: rel="lightbox" in subsilver2]]></change>
          <change><![CDATA[[Fix] Report #251: Undefined variable: sort_new_comment_option]]></change>
          <change><![CDATA[[Fix] Report #256: Undefined index: cat_approval]]></change>
          <change><![CDATA[[Fix] Report #253: Sessionhandling of 3.0.1]]></change>
          <change><![CDATA[[Fix] Report #242: Old Link in Installer Footer]]></change>
          <change><![CDATA[[Fix] Report #243: non strict sql]]></change>
          <change><![CDATA[[Fix] Report #244: Misspelled Information after successful Installation]]></change>
          <change><![CDATA[[Fix] Report #248: image size on massimport when disabled]]></change>
          <change><![CDATA[[Fix] Report #250: Potential exposure of real path when unlinking files]]></change>
          <change><![CDATA[[Fix] Report #240: When deleting album in subsilver2, language not shown]]></change>
          <change><![CDATA[[Fix] Report #249: When editing image 'Title' box isn't populated]]></change>
          <change><![CDATA[[Fix] Report #237: Option when create a module for UCP]]></change>
          <change><![CDATA[[Fix] Report #236: Undefined variable: album_config]]></change>
          <change><![CDATA[[Fix] Report #225: [Sec] upload and move images to personal albums]]></change>
          <change><![CDATA[[Fix] Report #223: Undefined index: IMG_BUTTON_UPLOAD_IMAGE]]></change>
          <change><![CDATA[[Fix] Report #226: wrong permissions used on displaying moderating options]]></change>
          <change><![CDATA[[Fix] Report #227: Gallery link on breadcrumbs in viewonline.php]]></change>
          <change><![CDATA[[Fix] Report #230: viewing all albums in jumpbox]]></change>
          <change><![CDATA[[Fix] Report #228: 0.2.3 to 0.3.0 upgrade won't update version]]></change>
          <change><![CDATA[[Fix] Report #229: Can't edit or delete comment in subsilver2]]></change>
        </changelog>
      </entry>
    </history>
    <meta name="generator" content="Phpbb.ModTeam.Tools (c#)" />
  </header>
  <action-group>
    <copy>
      <file from="root/adm/style/acp_gallery.html" to="adm/style/acp_gallery.html" />
      <file from="root/gallery/*.*" to="gallery/*.*" />
      <file from="root/gallery/includes/*.*" to="gallery/includes/*.*" />
      <file from="root/gallery/upload/*.*" to="gallery/upload/*.*" />
      <file from="root/gallery/upload/cache/*.*" to="gallery/upload/cache/*.*" />
      <file from="root/includes/acp/acp_gallery.php" to="includes/acp/acp_gallery.php" />
      <file from="root/includes/acp/info/acp_gallery.php" to="includes/acp/info/acp_gallery.php" />
      <file from="root/includes/ucp/ucp_gallery.php" to="includes/ucp/ucp_gallery.php" />
      <file from="root/includes/ucp/info/ucp_gallery.php" to="includes/ucp/info/ucp_gallery.php" />
      <file from="root/install_gallery/*.*" to="install_gallery/*.*" />
      <file from="root/install_gallery/schemas/*.*" to="install_gallery/schemas/*.*" />
      <file from="root/language/en/mods/*.*" to="language/en/mods/*.*" />
      <file from="root/styles/prosilver/imageset/en/button_upload_image.gif" to="styles/prosilver/imageset/en/button_upload_image.gif" />
      <file from="root/styles/prosilver/imageset/icon_contact_gallery.gif" to="styles/prosilver/imageset/icon_contact_gallery.gif" />
      <file from="root/styles/prosilver/template/*.*" to="styles/prosilver/template/*.*" />
      <file from="root/styles/prosilver/theme/gallery_lytebox.css" to="styles/prosilver/theme/gallery_lytebox.css" />
      <file from="root/styles/prosilver/theme/images/gallery_lytebox/*.*" to="styles/prosilver/theme/images/gallery_lytebox/*.*" />
      <file from="root/styles/prosilver/theme/images/icon_gallery.gif" to="styles/prosilver/theme/images/icon_gallery.gif" />
    </copy>
    <open src="viewonline.php">
      <edit>
        <find><![CDATA[$sql = 'SELECT u.user_id, u.username, u.username_clean, u.user_type, u.user_colour, s.session_id, s.session_time, s.session_page, s.session_ip, s.session_browser, s.session_viewonline, s.session_forum_id]]></find>
        <inline-edit>
            <inline-find><![CDATA[, s.session_forum_id]]></inline-find>
            <inline-action type="after-add"><![CDATA[, s.session_album_id]]></inline-action>
        </inline-edit>
      </edit>
      <edit>
        <find><![CDATA[include("$phpbb_root_path" . GALLERY_ROOT_PATH . "includes/common.$phpEx");]]></find>
        <action type="before-add"><![CDATA[$recent_image_addon = false;]]></action>
      </edit>
      <edit>
        <find><![CDATA[			preg_match('#_album_id_=([0-9]+)x#i', $row['session_page'], $album_id);
			$album_id = (sizeof($album_id)) ? (int) $album_id[1] : 0;]]></find>
        <action type="replace-with"><![CDATA[$album_id = $row['session_album_id'];]]></action>
      </edit>
    </open>
    <open src="includes/functions_user.php">
      <edit>
        <find><![CDATA[	$sql = 'UPDATE ' . GALLERY_ALBUMS_TABLE . "
		SET album_name = '" . $db->sql_escape($new_name) . "'
		WHERE album_name = '" . $db->sql_escape($old_name) . "'
			AND album_user_id != 0
			AND parent_id = 0";
	$db->sql_query($sql);]]></find>
        <action type="replace-with"><![CDATA[	$sql = 'UPDATE ' . GALLERY_ALBUMS_TABLE . "
		SET album_name = '" . $db->sql_escape($new_name) . "'
		WHERE album_name = '" . $db->sql_escape($old_name) . "'
			AND album_user_id <> 0
			AND parent_id = 0";
	$db->sql_query($sql);]]></action>
      </edit>
    </open>
    <open src="includes/session.php">
      <edit>
        <find><![CDATA[$this->page['page'] .= (isset($_REQUEST['album_id'])) ? ((strpos($this->page['page'], '?') !== false) ? '&' : '?') . '_album_id_=' . (int) $_REQUEST['album_id'] . 'x' : '';]]></find>
        <action type="replace-with"><![CDATA[]]></action>
      </edit>
      <edit>
        <find><![CDATA['forum'				=> (isset($_REQUEST['f']) && $_REQUEST['f'] > 0) ? (int) $_REQUEST['f'] : 0,]]></find>
        <action type="after-add"><![CDATA['album'				=> (isset($_REQUEST['album_id']) && $_REQUEST['album_id'] > 0) ? (int) $_REQUEST['album_id'] : 0,]]></action>
      </edit>
      <edit>
        <find><![CDATA[$sql_ary['session_forum_id'] = $this->page['forum'];]]></find>
        <action type="after-add"><![CDATA[$sql_ary['session_album_id'] = $this->page['album'];]]></action>
      </edit>
      <edit>
        <find><![CDATA[							// If the database is not yet updated, there will be an error due to the session_forum_id
							// @todo REMOVE for 3.0.2]]></find>
        <action type="before-add"><![CDATA[							if ($result === false)
							{
								unset($sql_ary['session_album_id']);
							}]]></action>
      </edit>
    </open>
    <diy-instructions lang="de"><![CDATA[Rufe install/ auf und führe das Update-Script aus

Leere den Cache im "Administrations-Bereich" (ACP) > "Allgemein" > "Den Cache leeren"

Aktualisiere deine Styles:
    "Administrations-Bereich" (ACP) > "Styles" > "Templates" > jedes > "Aktualisieren"
    "Administrations-Bereich" (ACP) > "Styles" > "Themes" > jedes > "Aktualisieren"
    "Administrations-Bereich" (ACP) > "Styles" > "Grafiksammlungen" > jedes > "Aktualisieren"
]]></diy-instructions>
    <diy-instructions lang="en-gb"><![CDATA[Browse to install/ and run the update-script

Clear your cache in the "Administration Control Panel" (ACP) > "General" > "Purge the cache"

Refresh your Styles:
    "Administration Control Panel" (ACP) > "Styles" > "Templates" > each > "refresh"
    "Administration Control Panel" (ACP) > "Styles" > "Themes" > each > "refresh"
    "Administration Control Panel" (ACP) > "Styles" > "Imagesets" > each > "refresh"
]]></diy-instructions>
  </action-group>
</mod>